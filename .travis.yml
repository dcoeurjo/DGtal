language: cpp

compiler:
  - gcc
#  - clang


cache: apt

env:
#  - BTYPE="-DCMAKE_BUILD_TYPE=Debug -DWITH_QGLVIEWER=true -DBUILD_TESTING=OFF"
#  - BTYPE="-DCMAKE_BUILD_TYPE=Debug -DWITH_CAIRO=true -DBUILD_TESTING=OFF"
#  - BTYPE="-DCMAKE_BUILD_TYPE=Debug -DWITH_MAGICK=true -DWITH_GMP=true -DBUILD_TESTING=OFF"
#  - BTYPE="-DCMAKE_BUILD_TYPE=Release  -DBUILD_TESTING=OFF"
  - BTYPE="-DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTING=ON -DBUILD_EXAMPLES=OFF"

before_script:
  - sudo apt-get -qq install libboost-program-options-dev
## libcairo2-dev libgraphicsmagick++1-dev libboost-system-dev libgmp-dev libqglviewer-qt4-dev

before_install:
  - sudo pip install cpp-coveralls --use-mirrors
  - gem install coveralls-lcov
  - sudo apt-get install -y lcov

 # - git clone https://github.com/dcoeurjo/cpp-coveralls.git
 # - cd cpp-coveralls
 # - sudo python setup.py install
 # - cd ..

# before_script:
#   - sudo apt-get -qq update
#   - sudo apt-get -qq install libboost-program-options-dev libcairo2-dev libgraphicsmagick++1-dev libboost-system-dev libgmp-dev libqglviewer-qt4-dev libinsighttoolkit3-dev libgdcm2-dev

##libboost-thread-dev  libeigen3-dev liblapack-dev libblas-dev libmpfr-dev
##CGAL specific (WIP)
#  - mkdir cgal && cd cgal
#  - wget https://gforge.inria.fr/frs/download.php/32994/CGAL-4.3.tar.gz
#  - tar zxvf CGAL-4.3.tar.gz && cd CGAL-4.3
#  - cmake . -DWITH_Eigen3=true -DWITH_GMPXX=true -DWITH_LAPACK=true -DWITH_BLAS=true
#  - make -s
#  - sudo make install -s
#  - cd ../..


matrix:
  exclude:
    - compiler: gcc
      env: BTYPE="-DCMAKE_BUILD_TYPE=Debug -DWITH_QGLVIEWER=true -DBUILD_TESTING=OFF"
    - compiler: gcc
      env: BTYPE="-DCMAKE_BUILD_TYPE=Debug -DWITH_CAIRO=true -DBUILD_TESTING=OFF"
    - compiler: gcc
      env: BTYPE="-DCMAKE_BUILD_TYPE=Debug -DWITH_MAGICK=true -DWITH_GMP=true -DBUILD_TESTING=OFF"
    - compiler: clang
      env: BTYPE="-DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTING=OFF"


script:
  - cmake . $BTYPE
  - make DGtal
  - make DGtalIO
  - cd examples
  - make
  - cd ../tests
  - make
  - cd ..
  - make

after_script:
#  - make test
  - make lcov
 # - coveralls --exclude lib --exclude tests -e /usr/include --encoding latin-1 -e examples -e CMakeFiles
#  - lcov --compat-libtool --directory . --capture --output-file coverage.info
  - coveralls-lcov coverage/stap.info